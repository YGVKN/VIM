<!DOCTYPE html>
<!-- This site was created in Webflow. http://www.webflow.com-->
<!-- Last Published: Fri Nov 13 2015 01:48:45 GMT+0000 (UTC) -->
<html lang="en" data-wf-site="56414d6fc8c27cad0f4e12e7" data-wf-page="5643ac587b1f28dc58ed6b89">
<head>
  <meta charset="utf-8">
  <title>Clojure - Anatomy of a Reducer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="generator" content="Webflow">
  <meta name="google-site-verification" content="a30CDuC9UBifM7EL575LK9a4TEE6mNfWbKqXIoSZChg" />
  <meta name="google-site-verification" content="iXqpntr4CN3JRM1sVm5D_YzZw8bFRizBaTVycwqii2E" />
  <meta name="keywords" content="clojure,programming" />
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;1,300;1,400;1,600&family=PT+Serif:ital@0;1&&family=Source+Code+Pro:wght@500&display=swap">
  <link rel="stylesheet" type="text/css" href="/css/normalize.css">
  <link rel="stylesheet" type="text/css" href="/css/webflow.css">
  <link rel="stylesheet" type="text/css" href="/css/clojureorg.webflow.css">
  <link rel="stylesheet" type="text/css" href="/css/asciidoctor-mod.css">
  <link type="text/css" href="/css/default-en.css" rel="stylesheet">
  <link type="text/css" href="/css/default.css" rel="stylesheet">
  <link type="text/css" href="/css/search-result.css" rel="stylesheet">
  <link rel="alternate" type="application/atom+xml" title="News" href="/feed.xml" />
  <script type="text/javascript" src="/js/modernizr.js"></script>
  <link rel="shortcut icon" type="image/x-icon" href="/images/clojure-logo-icon-32.png">
  <link rel="apple-touch-icon" href="/images/clojure-logo-icon-256.png">
  <!-- Matomo -->
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="https://cognitect.matomo.cloud/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '9']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src='//cdn.matomo.cloud/cognitect.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
<!-- End Matomo Code -->
  <script type="text/javascript">
    function searchClj(obj) {
      let e = document.getElementById("searchType");
      document.getElementById("hiddenSearch").value=e.value;
    }
  </script>
</head>
<body>
  <div data-collapse="none" data-animation="default" data-duration="400" data-contain="1" class="w-nav clj-navbar">
    <div class="w-container">
      <a href="/index" class="w-nav-brand w-clearfix clj-logo-container"><img width="60" src="/images/clojure-logo-120b.png" class="clj-logo" alt="Clojure logo">
        <div class="clj-logo-text">Clojure</div>
      </a>
      <nav role="navigation" class="w-nav-menu clj-nav-menu"><a href="/about/rationale" class="w-nav-link clj-nav-link">Overview</a><a href="/reference/documentation" class="w-nav-link clj-nav-link">Reference‚Äç</a><a href="/api/api" class="w-nav-link clj-nav-link">API</a><a href="/releases/downloads" class="w-nav-link clj-nav-link">Releases</a><a href="/guides/guides" class="w-nav-link clj-nav-link">Guides</a><a href="/community/success_stories" class="w-nav-link clj-nav-link">Community</a><a href="/dev/dev" class="w-nav-link clj-nav-link">Dev</a><a href="/news/news" class="w-nav-link clj-nav-link">News</a><a href="#" data-ix="search-click-trigger" class="w-nav-link clj-nav-link clj-nav-search">&#xed11;</a>
      </nav>
      <div class="w-nav-button clj-menu-button">
        <div class="w-icon-nav-menu"></div>
      </div>
    </div>
  </div>
  <div data-ix="hide-search" class="w-section clj-search-section">
    <div class="w-container">
      <div class="w-form clj-search-form-wrapper">
        <form id="wf-form-Search-Form" name="wf-form-Search-Form" action="https://duckduckgo.com/" method="get" onSubmit="searchClj(this)">
          <div class="w-row">
            <div class="w-col w-col-6 w-col-small-6">
              <input id="hiddenSearch" type="hidden" name="sites" value="www.clojure.org">
              <input name="q" id="q" type="text" placeholder="Search clojure.org reference, guides, and API" title="Search text" autofocus="autofocus" class="w-input clj-search-input">
            </div>
            <div class="w-col w-col-3 w-col-small-3 clj-search-type">
              <select name="searchType" id="searchType" class="w-select clj-search-type">
                <option value="www.clojure.org">clojure.org</option>
                <option value="ask.clojure.org">ask.clojure.org</option>
              </select>
            </div>
            <div class="w-col w-col-3 w-col-small-3">
              <input type="submit" value="Search" class="w-button clj-search-submit">
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

<div class="w-section clj-content-section">
  <div class="w-container">
    <div class="clj-section-nav-container">
      <div data-collapse="small" data-animation="default" data-duration="200" data-contain="1" class="w-nav clj-section-navbar">
        <div class="w-container">
          <nav role="navigation" class="w-nav-menu clj-section-nav-menu">
                <a href="/news/2023/12/15/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Dec 15, 2023)</a>
                <a href="/news/2023/12/08/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Dec 8, 2023)</a>
                <a href="/news/2023/12/01/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Dec 1, 2023)</a>
                <a href="/news/2023/11/24/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Nov 24, 2023)</a>
                <a href="/news/2023/11/17/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Nov 17, 2023)</a>
                <a href="/news/2023/11/10/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Nov 10, 2023)</a>
                <a href="/news/2023/11/03/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Nov 3, 2023)</a>
                <a href="/news/2023/10/27/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Oct 27, 2023)</a>
                <a href="/news/2023/10/23/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Oct 23, 2023)</a>
                <a href="/news/2023/10/20/clojure-1-12-alpha5" class="w-nav-link clj-section-nav-item-link">Clojure 1.12.0-alpha5</a>
                <a href="/news/2023/10/16/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Oct 16, 2023)</a>
                <a href="/news/2023/10/06/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Oct 6, 2023)</a>
                <a href="/news/2023/09/29/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Sept 29, 2023)</a>
                <a href="/news/2023/09/22/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Sept 22, 2023)</a>
                <a href="/news/2023/09/15/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Sept 15, 2023)</a>
                <a href="/news/2023/09/08/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Sept 8, 2023)</a>
                <a href="/news/2023/09/01/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Sept 1, 2023)</a>
                <a href="/news/2023/08/25/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Aug 25, 2023)</a>
                <a href="/news/2023/08/18/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Aug 18, 2023)</a>
                <a href="/news/2023/08/11/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Aug 11, 2023)</a>
                <a href="/news/2023/08/06/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Aug 6, 2023)</a>
                <a href="/news/2023/08/04/next-rich" class="w-nav-link clj-section-nav-item-link">(next Rich)</a>
                <a href="/news/2023/07/28/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (July 28, 2023)</a>
                <a href="/news/2023/07/20/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (July 20, 2023)</a>
                <a href="/news/2023/07/07/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (July 7, 2023)</a>
                <a href="/news/2023/06/30/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (June 30, 2023)</a>
                <a href="/news/2023/06/30/state-of-clojure-2023" class="w-nav-link clj-section-nav-item-link">State of Clojure 2023 Results</a>
                <a href="/news/2023/06/23/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (June 23, 2023)</a>
                <a href="/news/2023/06/16/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (June 16, 2023)</a>
                <a href="/news/2023/06/09/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (June 9, 2023)</a>
                <a href="/news/2023/06/02/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (June 2, 2023)</a>
                <a href="/news/2023/05/26/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (May 26, 2023)</a>
                <a href="/news/2023/05/19/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (May 19, 2023)</a>
                <a href="/news/2023/05/12/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (May 12, 2023)</a>
                <a href="/news/2023/05/05/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (May 5, 2023)</a>
                <a href="/news/2023/05/01/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (May 1, 2023)</a>
                <a href="/news/2023/04/28/introducing-morse" class="w-nav-link clj-section-nav-item-link">Introducing Morse</a>
                <a href="/news/2023/04/21/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Apr 21, 2023)</a>
                <a href="/news/2023/04/14/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Apr 14, 2023)</a>
                <a href="/news/2023/04/14/clojure-1-12-alpha2" class="w-nav-link clj-section-nav-item-link">Clojure 1.12.0-alpha2</a>
                <a href="/news/2023/04/10/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Apr 10, 2023)</a>
                <a href="/news/2023/03/31/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Mar 31, 2023)</a>
                <a href="/news/2023/03/27/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Mar 27, 2023)</a>
                <a href="/news/2023/03/18/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Mar 18, 2023)</a>
                <a href="/news/2023/03/10/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Mar 10, 2023)</a>
                <a href="/news/2023/03/03/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Mar 3, 2023)</a>
                <a href="/news/2023/02/27/clojure-survey-2023" class="w-nav-link clj-section-nav-item-link">State of Clojure 2023 Survey</a>
                <a href="/news/2023/02/26/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Feb 26, 2023)</a>
                <a href="/news/2023/02/17/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Feb 17, 2023)</a>
                <a href="/news/2023/02/10/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Feb 10, 2023)</a>
                <a href="/news/2023/02/03/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Feb 3, 2023)</a>
                <a href="/news/2023/01/30/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Jan 30, 2023)</a>
                <a href="/news/2023/01/20/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Jan 20, 2023)</a>
                <a href="/news/2023/01/13/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Jan 13, 2023)</a>
                <a href="/news/2023/01/06/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Jan 6, 2023)</a>
                <a href="/news/2022/12/22/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Dec 22, 2022)</a>
                <a href="/news/2022/12/16/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Dec 16, 2022)</a>
                <a href="/news/2022/12/08/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Dec 8, 2022)</a>
                <a href="/news/2022/12/02/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Dec 2, 2022)</a>
                <a href="/news/2022/11/23/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Nov 23, 2022)</a>
                <a href="/news/2022/11/18/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Nov 18, 2022)</a>
                <a href="/news/2022/11/11/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Nov 11, 2022)</a>
                <a href="/news/2022/11/04/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Nov 4, 2022)</a>
                <a href="/news/2022/10/28/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Oct 28, 2022)</a>
                <a href="/news/2022/10/21/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Oct 21, 2022)</a>
                <a href="/news/2022/10/14/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Oct 14, 2022)</a>
                <a href="/news/2022/10/10/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Oct 10, 2022)</a>
                <a href="/news/2022/10/03/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Oct 3, 2022)</a>
                <a href="/news/2022/09/26/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Sep 26, 2022)</a>
                <a href="/news/2022/09/16/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Sep 16, 2022)</a>
                <a href="/news/2022/09/09/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Sep 9, 2022)</a>
                <a href="/news/2022/09/02/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Sep 2, 2022)</a>
                <a href="/news/2022/08/26/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Aug 26, 2022)</a>
                <a href="/news/2022/08/19/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Aug 19, 2022)</a>
                <a href="/news/2022/08/12/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Aug 12, 2022)</a>
                <a href="/news/2022/08/05/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Aug 5, 2022)</a>
                <a href="/news/2022/07/30/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (July 30, 2022)</a>
                <a href="/news/2022/07/15/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (July 15, 2022)</a>
                <a href="/news/2022/07/08/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (July 8, 2022)</a>
                <a href="/news/2022/07/01/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (July 1, 2022)</a>
                <a href="/news/2022/06/30/clojure1-12-alpha1" class="w-nav-link clj-section-nav-item-link">Clojure 1.12.0-alpha1</a>
                <a href="/news/2022/06/24/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (June 24, 2022)</a>
                <a href="/news/2022/06/17/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (June 17, 2022)</a>
                <a href="/news/2022/06/10/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (June 10, 2022)</a>
                <a href="/news/2022/06/02/state-of-clojure-2022" class="w-nav-link clj-section-nav-item-link">State of Clojure 2022 Results</a>
                <a href="/news/2022/06/02/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (June 2, 2022)</a>
                <a href="/news/2022/05/27/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (May 27, 2022)</a>
                <a href="/news/2022/05/20/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (May 20, 2022)</a>
                <a href="/news/2022/05/13/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (May 13, 2022)</a>
                <a href="/news/2022/05/06/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (May 6, 2022)</a>
                <a href="/news/2022/04/29/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Apr 29, 2022)</a>
                <a href="/news/2022/04/22/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Apr 22, 2022)</a>
                <a href="/news/2022/04/14/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Apr 14, 2022)</a>
                <a href="/news/2022/04/08/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Apr 8, 2022)</a>
                <a href="/news/2022/04/05/clojure-1-11-1" class="w-nav-link clj-section-nav-item-link">Clojure 1.11.1 release</a>
                <a href="/news/2022/04/01/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Apr 1, 2022)</a>
                <a href="/news/2022/03/25/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Mar 25, 2022)</a>
                <a href="/news/2022/03/22/clojure-1-11-0" class="w-nav-link clj-section-nav-item-link">Clojure 1.11.0 release</a>
                <a href="/news/2022/03/20/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Mar 20, 2022)</a>
                <a href="/news/2022/03/11/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Mar 11, 2022)</a>
                <a href="/news/2022/03/04/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Mar 4, 2022)</a>
                <a href="/news/2022/02/28/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Feb 28, 2022)</a>
                <a href="/news/2022/02/22/clojure-2022-survey" class="w-nav-link clj-section-nav-item-link">State of Clojure 2022 Survey</a>
                <a href="/news/2022/02/18/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Feb 18, 2022)</a>
                <a href="/news/2022/02/14/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Feb 14, 2022)</a>
                <a href="/news/2022/02/04/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Feb 4, 2022)</a>
                <a href="/news/2022/01/28/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Jan 28, 2022)</a>
                <a href="/news/2022/01/21/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Jan 21, 2022)</a>
                <a href="/news/2022/01/14/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Jan 14, 2022)</a>
                <a href="/news/2022/01/07/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Jan 7, 2022)</a>
                <a href="/news/2021/12/23/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Dec 23, 2021)</a>
                <a href="/news/2021/12/17/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Dec 17, 2021)</a>
                <a href="/news/2021/12/10/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Dec 10, 2021)</a>
                <a href="/news/2021/12/02/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Dec 2, 2021)</a>
                <a href="/news/2021/11/24/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Nov 24, 2021)</a>
                <a href="/news/2021/11/19/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Nov 19, 2021)</a>
                <a href="/news/2021/11/12/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Nov 12, 2021)</a>
                <a href="/news/2021/11/5/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Nov 5, 2021)</a>
                <a href="/news/2021/10/29/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Oct 29, 2021)</a>
                <a href="/news/2021/10/22/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Oct 22, 2021)</a>
                <a href="/news/2021/10/14/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Oct 14, 2021)</a>
                <a href="/news/2021/10/08/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Oct 8, 2021)</a>
                <a href="/news/2021/09/24/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Sept 24, 2021)</a>
                <a href="/news/2021/09/17/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Sept 17, 2021)</a>
                <a href="/news/2021/09/10/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Sept 10, 2021)</a>
                <a href="/news/2021/09/03/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Sept 3, 2021)</a>
                <a href="/news/2021/08/27/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Aug 27, 2021)</a>
                <a href="/news/2021/08/20/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Aug 20, 2021)</a>
                <a href="/news/2021/08/13/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (Aug 13, 2021)</a>
                <a href="/news/2021/07/30/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (July 30, 2021)</a>
                <a href="/news/2021/07/23/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (July 23, 2021)</a>
                <a href="/news/2021/07/16/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (July 16, 2021)</a>
                <a href="/news/2021/07/09/source-libs-builds" class="w-nav-link clj-section-nav-item-link">Source Libs and Builds</a>
                <a href="/news/2021/07/09/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (July 9, 2021)</a>
                <a href="/news/2021/07/02/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (July 2, 2021)</a>
                <a href="/news/2021/06/25/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (June 25, 2021)</a>
                <a href="/news/2021/06/18/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (June 18, 2021)</a>
                <a href="/news/2021/06/11/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (June 11, 2021)</a>
                <a href="/news/2021/06/04/deref" class="w-nav-link clj-section-nav-item-link">Clojure Deref (June 4, 2021)</a>
                <a href="/news/2021/04/06/state-of-clojure-2021" class="w-nav-link clj-section-nav-item-link">State of Clojure 2021 Results</a>
                <a href="/news/2021/03/18/apis-serving-people-and-programs" class="w-nav-link clj-section-nav-item-link">Keyword argument functions now also accept maps</a>
                <a href="/news/2021/03/04/clojure1-10-3" class="w-nav-link clj-section-nav-item-link">Clojure 1.10.3 release</a>
                <a href="/news/2021/01/26/clojure1-10-2" class="w-nav-link clj-section-nav-item-link">Clojure 1.10.2 release</a>
                <a href="/news/2021/01/14/clojure-2021-survey" class="w-nav-link clj-section-nav-item-link">State of Clojure 2021 Survey</a>
                <a href="/news/2020/07/23/cognitect-joins-nubank" class="w-nav-link clj-section-nav-item-link">Cognitect Joins Nubank!</a>
                <a href="/news/2020/02/28/clojure-tap" class="w-nav-link clj-section-nav-item-link">Clojure Homebrew Tap</a>
                <a href="/news/2020/02/20/state-of-clojure-2020" class="w-nav-link clj-section-nav-item-link">State of Clojure 2020 Results</a>
                <a href="/news/2020/01/07/clojure-2020-survey" class="w-nav-link clj-section-nav-item-link">State of Clojure 2020 Survey</a>
                <a href="/news/2019/07/25/clojure-forum" class="w-nav-link clj-section-nav-item-link">Clojure Forum</a>
                <a href="/news/2019/06/06/clojure1-10-1" class="w-nav-link clj-section-nav-item-link">Clojure 1.10.1 release</a>
                <a href="/news/2019/05/16/jira-migration" class="w-nav-link clj-section-nav-item-link">JIRA Migration</a>
                <a href="/news/2019/02/04/state-of-clojure-2019" class="w-nav-link clj-section-nav-item-link">State of Clojure 2019 Results</a>
                <a href="/news/2019/01/07/clojure-2019-survey" class="w-nav-link clj-section-nav-item-link">State of Clojure 2019 Survey</a>
                <a href="/news/2018/12/17/clojure110" class="w-nav-link clj-section-nav-item-link">Clojure 1.10 release</a>
                <a href="/news/2018/03/19/state-of-clojure-2018" class="w-nav-link clj-section-nav-item-link">State of Clojure 2018 Results</a>
                <a href="/news/2018/01/05/git-deps" class="w-nav-link clj-section-nav-item-link">Git Deps for Clojure</a>
                <a href="/news/2017/12/08/clojure19" class="w-nav-link clj-section-nav-item-link">Clojure 1.9 is now available</a>
                <a href="/news/2017/01/31/state-of-clojure-2016" class="w-nav-link clj-section-nav-item-link">State of Clojure 2016 Results</a>
                <a href="/news/2016/05/23/introducing-clojure-spec" class="w-nav-link clj-section-nav-item-link">Introducing clojure.spec</a>
                <a href="/news/2016/01/28/state-of-clojure-2015" class="w-nav-link clj-section-nav-item-link">State of Clojure 2015 survey results</a>
                <a href="/news/2016/01/19/clojure18" class="w-nav-link clj-section-nav-item-link">Clojure 1.8 is now available</a>
                <a href="/news/2016/01/14/clojure-org-live" class="w-nav-link clj-section-nav-item-link">Welcome to the new clojure.org!</a>
                <a href="/news/2015/06/30/clojure-17" class="w-nav-link clj-section-nav-item-link">Clojure 1.7 is now available</a>
                <a href="/news/2014/08/06/transducers-are-coming" class="w-nav-link clj-section-nav-item-link">Transducers are Coming</a>
                <a href="/news/2013/06/28/clojure-clore-async-channels" class="w-nav-link clj-section-nav-item-link">Clojure core.async Channels</a>
                <a href="/news/2012/05/15/anatomy-of-reducer" class="w-nav-link clj-section-nav-item-link">Anatomy of a Reducer</a>
                <a href="/news/2012/05/08/reducers" class="w-nav-link clj-section-nav-item-link">Reducers - A Library and Model for Collection Processing</a>
                <a href="/news/2012/02/17/clojure-governance" class="w-nav-link clj-section-nav-item-link">Clojure Governance and How It Got That Way</a>
                <a href="/news/2011/07/22/introducing-clojurescript" class="w-nav-link clj-section-nav-item-link">Introducing ClojureScript</a>
          </nav>
          <div data-ix="toggle-section-nav-icon" class="w-nav-button w-clearfix clj-section-nav-toggle">
            <div class="clj-section-nav-text">Anatomy of a Reducer</div>
            <div class="clj-section-nav-icon-closed">&#xeab2;</div>
            <div data-ix="init-hide-section-nav-icon-open" class="clj-section-nav-icon-open">&#xeab9;</div>
          </div>
        </div>
      </div>
    </div>

    <div class="clj-content-container">
      <h1>Anatomy of a Reducer</h1>
      <p><em>15 May 2012</em><br/>
         <em>Rich Hickey</em></p>

      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Last time, <a href="xref/../../08/reducers">I blogged</a> about Clojure&#8217;s new <a href="https://github.com/clojure/clojure/blob/master/src/clj/clojure/core/reducers.clj">reducers library</a>. This time I&#8217;d like to look at the details of what constitutes a reducer, as well as some background about the library.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whats_a_reducing_function"><a class="anchor" href="#_whats_a_reducing_function"></a>What&#8217;s a Reducing Function?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The reducers library is built around transforming reducing functions. A reducing function is simply a binary function, akin to the one you might pass to <em>reduce</em>. While the two arguments might be treated symmetrically by the function, there is an implied semantic that distinguishes the arguments: the first argument is a result or accumulator that is being built up by the reduction, while the second is some new input value from the source being reduced. While <em>reduce</em> works from the 'left', that is neither a property nor promise of the reducing function, but one of <em>reduce</em> itself. So we&#8217;ll say simply that a reducing fn has the shape:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="clojure">(f result input) -&gt; new-result</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, a reducing fn may be called with no args, and should then return an identity value for its operation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transforming_reducing_functions"><a class="anchor" href="#_transforming_reducing_functions"></a>Transforming Reducing Functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A function that transforms a reducing fn simply takes one, and returns another one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="clojure">(xf reducing-fn) -&gt; reducing-fn</code></pre>
</div>
</div>
<div class="paragraph">
<p>Many of the core collection operations can be expressed in terms of such a transformation. Imagine if we were to define the cores of <em>map</em>, <em>filter</em> and <em>mapcat</em> in this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="clojure">(defn mapping [f]
  (fn [f1]
    (fn [result input]
      (f1 result (f input)))))

(defn filtering [pred]
  (fn [f1]
    (fn [result input]
      (if (pred input)
        (f1 result input)
        result))))

(defn mapcatting [f]
  (fn [f1]
    (fn [result input]
      (reduce f1 result (f input)))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a few things to note:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The functions consist only of the core logic of their operations</p>
</li>
<li>
<p>That logic does not include any notion of collection, nor order</p>
</li>
<li>
<p>filtering and kin can 'skip' inputs by simply returning the incoming result</p>
</li>
<li>
<p>mapcatting and kin can produce more than one result per input by simply operating on result more than once</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using these directly is somewhat odd, because we are operating on the reducing operation rather than the collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="clojure">(reduce + 0 (map inc [1 2 3 4]))
;;becomes
(reduce ((mapping inc) +) 0 [1 2 3 4])</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reducers"><a class="anchor" href="#_reducers"></a>Reducers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We expect map/filter etc to take and return logical collections. The premise of the reducers library is that the minimum definition of collection is something that is reducible. reduce ends up using a protocol (CollReduce) to ask the collection to <em>reduce</em> itself, so we can make reducible things by extending that protocol. Thus, given a collection and a reducing function transformer like those above, we can make a reducible with a function like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="clojure">(defn reducer
  ([coll xf]
   (reify
    clojure.core.protocols/CollReduce
    (coll-reduce [_ f1 init]
      (clojure.core.protocols/coll-reduce coll (xf f1) init)))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="clojure">(reduce + 0 (map inc [1 2 3 4]))
;;becomes
(reduce + 0 (reducer [1 2 3 4] (mapping inc)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s better. It feels as if we have transformed the collection itself. Note:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>reducer ultimately asks the source collection to reduce <em>itself</em></p>
</li>
<li>
<p>reducer will work with any reducing function transformer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Another objective of the library is to support reducer-based code with the same shape as our current seq-based code. Getting there is easy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="clojure">(defn rmap [f coll]
  (reducer coll (mapping f)))

(defn rfilter [pred coll]
  (reducer coll (filtering pred)))

(defn rmapcat [f coll]
  (reducer coll (mapcatting f)))

(reduce + 0 (rmap inc [1 2 3 4]))
;=&gt; 14

(reduce + 0 (rfilter even? [1 2 3 4]))
;=&gt; 6

(reduce + 0 (rmapcat range [1 2 3 4 5]))
;=&gt; 20</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_from_reducible_to_parallel_foldable"><a class="anchor" href="#_from_reducible_to_parallel_foldable"></a>From Reducible to (Parallel) Foldable</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While it is an interesting exercise to find another fundamental way to define the core collection operations, the end result is not much different, just faster, certainly something <a href="http://citeseer.ist.psu.edu/viewdoc/summary?doi=10.1.1.104.7401">a state-of-the-art compilation and type system</a> (had we one) might do for us given sequence code. To stop here would be to completely miss the point of the library. These operations have different, fundamentally simpler semantics than their sequence-based counterparts.</p>
</div>
<div class="paragraph">
<p>How does one define parallel mapping/filtering/mapcatting etc? <em>We already did!</em> As long as the transformation itself doesn&#8217;t care about order (e.g. as <em>take</em> does), then a reducer is as foldable as its source. As with <em>reduce</em>, <em>fold</em> bottoms out on a protocol (CollFold), and our reducer can extend that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="clojure">(defn folder
  ([coll xf]
     (reify
      ;;extend CollReduce as before

      CollFold
      (coll-fold [_ n combinef reducef]
        (coll-fold coll n combinef (xf reducef))))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>folder</em> has the same requirements as <em>reducer</em> - collection + reducing function transformer</p>
</li>
<li>
<p>when <em>fold</em> is applied to something that can&#8217;t fold, it devolves to <em>reduce</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thus the real definitions of reducers/map et al use <em>folder</em> (while take uses <em>reducer</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="clojure">(defn rmap [f coll]
  (folder coll (mapping f)))

(defn rfilter [pred coll]
  (folder coll (filtering pred)))

(defn rmapcat [f coll]
  (folder coll (mapcatting f)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thus a wide variety of collection transformations can instead be expressed as reducing function transformations, and applied in both sequential and parallel contexts, across a wide variety of data structures.</p>
</div>
<div class="paragraph">
<p>The library deals with several other details, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the transformers all need a nullary arity that just delegates to the transformed reducing function</p>
</li>
<li>
<p>the transformers support a ternary arity where 2 inputs are supplied per step, as occurs with reduce-kv and map sources</p>
</li>
<li>
<p>all of the reducers are curried</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These additions are all mechanical, and are handled by macros. It is my hope that the above will help illuminate the core logic underlying the library.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_background"><a class="anchor" href="#_background"></a>Background</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Much prior work highlights the value of fold as a primary mechanism for collection manipulation, superior to iteration, although most of that work was done in the context of recursively defined functions on lists or sequences - i.e. fold implies foldl/foldr, and the results remain inherently sequential.</p>
</div>
<div class="paragraph">
<p>The two primary motivators for this library were the Haskell Iteratee library and Guy Steele&#8217;s ICFP '09 talk.</p>
</div>
<div class="sect2">
<h3 id="_haskell_iteratees"><a class="anchor" href="#_haskell_iteratees"></a>Haskell Iteratees</h3>
<div class="paragraph">
<p>The <a href="http://www.haskell.org/haskellwiki/Enumerator_and_iteratee">Haskell Enumerator/Iteratee library</a> and its antecedents are an inspiring effort to disentangle the source of data and the operations that might apply to it, and one of the first I think to reify the role of the 'iteratee'. An enumerator makes successive calls to the iteratee to supply it items, decoupling the iteratee from the data source. But the iteratee is still driving in some sense, as it is in charge of signaling Done, and, it returns on each step the next iteratee to use, effectively dictating a single thread of control. One benefit is that even operations like <em>take</em> can be defined functionally, as they can encode their internal state in the 'next' iteratee returned. OTOH, and unlike reducers, the design wraps the result being built up in a new iteratee each step, with potential allocation overhead.</p>
</div>
<div class="paragraph">
<p>Being an automaton in a state, an iteratee is like a reified left fold, and thus inherently serial. So, while they form quite a nice substrate for the design of, e.g. parsers, iteratees are unsuitable for defining things like map/filter etc if one intends to be able to parallelize them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_guy_steeles_icfp_09_talk"><a class="anchor" href="#_guy_steeles_icfp_09_talk"></a>Guy Steele&#8217;s ICFP '09 talk</h3>
<div class="paragraph">
<p><a href="http://vimeo.com/6624203">Organizing Functional Code for Parallel Execution or, foldl and foldr Considered Slightly Harmful</a></p>
</div>
<div class="paragraph">
<p>This talk boils down to - stop programming with streams, lists, generators etc if you intend to exploit parallelism, as does the reducers library.</p>
</div>
<div class="paragraph">
<p>Where reducers diverges from that talk is in the structure of the fork/join parallel computation. Rather than map+reduce, reducers uses reduce+combine. This reflects 2 considerations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is accepted fork/join practice that at some point you stop splitting in half and handle the leaves 'sequentially'</p>
<div class="ulist">
<ul>
<li>
<p>if the best way to do that at the top is <em>reduce</em>, why not at the bottom as well?</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>map</em> forces a result per input</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can see the awkwardness of the latter in the map/reduce-oriented definition of parallel <em>filter</em> in the talk, which must 'listify' items or return empty lists, creating a bunch of concatenation busy-work for the reducing step. Many other collection algorithms suffer similarly in their map/reduce-oriented implementations, having greater internal complexity and wrapping the results in collection representations, with corresponding creation of more garbage and reduction busy-work etc vs the reducing function transformer versions of same.</p>
</div>
<div class="paragraph">
<p>It is interesting that the accumulator style is not completely absent from the reducers design, in fact it is important to the characteristics just described. What has been abandoned are the <em>single initial value</em> and <em>serial execution</em> promises of foldl/r.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I hope this makes reducers easier to understand, use and define.</p>
</div>
<div class="paragraph">
<p>Rich</p>
</div>
</div>
</div>
    </div>
  </div>
</div>

  <div class="w-section clj-footer">
    <div class="w-container clj-footer-links-container">
      <div class="w-row">
        <div class="w-col w-col-3 w-col-small-6 w-col-tiny-6">
          <h6 class="clj-footer-heading">Community</h6>
            <a href="/community/resources" class="clj-footer-link">Resources</a>
            <a href="/community/contributing" class="clj-footer-link">Contributing</a>
            <a href="/community/companies" class="clj-footer-link">Companies</a>
            <a href="/community/contributing_site" class="clj-footer-link">Site</a>
          <h6 class="clj-footer-heading">Legal</h6>
            <a href="/community/license" class="clj-footer-link">License</a>
            <a href="/privacy" class="clj-footer-link">Privacy Policy</a>
        </div>
        <div class="w-col w-col-3 w-col-small-6 w-col-tiny-6">
          <h6 class="clj-footer-heading">Documentation</h6>
            <a href="/about/rationale" class="clj-footer-link">Overview</a>
            <a href="/reference/documentation" class="clj-footer-link">Reference</a>
            <a href="/api/api" class="clj-footer-link">API</a>
            <a href="/guides/guides" class="clj-footer-link">Guides</a>
            <a href="/community/libraries" class="clj-footer-link">Libraries &amp; Tools</a>
        </div>
        <div class="w-col w-col-3 w-col-small-6 w-col-tiny-6">
          <h6 class="clj-footer-heading">Updates</h6>
            <a href="/news/news" class="clj-footer-link">News</a>
            <a href="/community/events" class="clj-footer-link">Events</a>
          <h6 class="clj-footer-heading">ETC</h6>
            <a href="https://www.youtube.com/user/ClojureTV" class="clj-footer-link">ClojureTV</a>
            <a href="/community/books" class="clj-footer-link">Books</a>
            <a href="/community/swag" class="clj-footer-link">Swag</a>
        </div>
        <div class="w-col w-col-3 w-col-small-6 w-col-tiny-6">
          <h6 class="clj-footer-heading">Code</h6>
            <a href="/releases/downloads" class="clj-footer-link">Releases</a>
            <a href="https://github.com/clojure/clojure/" class="clj-footer-link">Source</a>
            <a href="http://clojurescript.org" class="clj-footer-link">ClojureScript</a>
            <a href="/about/clojureclr" class="clj-footer-link">ClojureCLR</a>
        </div>
      </div>
    </div>
    <div class="w-container clj-footer-legal-container">
      <div class="w-clearfix clj-footer-legal">
        <div class="clj-footer-logo">&nbsp;</div>
        <div class="clj-footer-legal-links">
          <div class="clj-footer-copyright">Copyright 2008-2022 Rich Hickey | <a class="clj-footer-sub-link" href="/privacy">Privacy Policy</a><br/>Logo &amp; site design by Tom Hickey
          </div>
          <div class="clj-footer-designed-by">Published 2023-12-18<br/>Update <a class="clj-footer-sub-link" href="https://github.com/clojure/clojure-site/blob/master/content/news/2012/05/15/anatomy-of-reducer.adoc">this page</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript" src="/js/webflow.js"></script>
  <script type="text/javascript" src="/js/highlight.pack.js"></script>
  <script>
  $(document).ready( (event) => {
    $('pre code').each((index, obj) => {
      $(obj).addClass($(obj).attr("data-lang"));
      hljs.highlightBlock(obj);
    });
  });
  </script>
  <!--[if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif]-->
</body>
</html>
